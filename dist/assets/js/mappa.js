var Mr=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);import"./modulepreload-polyfill-B5Qt9EMX.js";import{l as Ir,p as Nr,i as Tr}from"./dataParser-Db8dEQbq.js";var ei=Mr((R,U)=>{var sr=typeof global=="object"&&global&&global.Object===Object&&global,Fr=typeof self=="object"&&self&&self.Object===Object&&self,Q=sr||Fr||Function("return this")(),J=Q.Symbol,ar=Object.prototype,Pr=ar.hasOwnProperty,Lr=ar.toString,bt=J?J.toStringTag:void 0,Dr=Object.prototype.toString,Wr="[object Null]",qr="[object Undefined]",ye=J?J.toStringTag:void 0;function mt(t){return t==null?t===void 0?qr:Wr:ye&&ye in Object(t)?function(e){var r=Pr.call(e,bt),n=e[bt];try{e[bt]=void 0;var o=!0}catch{}var s=Lr.call(e);return o&&(r?e[bt]=n:delete e[bt]),s}(t):function(e){return Dr.call(e)}(t)}function et(t){return t!=null&&typeof t=="object"}var Vr="[object Symbol]";function gt(t){return typeof t=="symbol"||et(t)&&mt(t)==Vr}function pt(t,e){for(var r=-1,n=t==null?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o}var W=Array.isArray,Br=1/0,be=J?J.prototype:void 0,_e=be?be.toString:void 0;function cr(t){if(typeof t=="string")return t;if(W(t))return pt(t,cr)+"";if(gt(t))return _e?_e.call(t):"";var e=t+"";return e=="0"&&1/t==-Br?"-0":e}function st(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function Wt(t){return t}var Rr="[object AsyncFunction]",Ur="[object Function]",Hr="[object GeneratorFunction]",Jr="[object Proxy]";function ur(t){if(!st(t))return!1;var e=mt(t);return e==Ur||e==Hr||e==Rr||e==Jr}var je,Rt=Q["__core-js_shared__"],Se=(je=/[^.]+$/.exec(Rt&&Rt.keys&&Rt.keys.IE_PROTO||""))?"Symbol(src)_1."+je:"",Gr=Function.prototype.toString;function at(t){if(t!=null){try{return Gr.call(t)}catch{}try{return t+""}catch{}}return""}var Yr=/^\[object .+?Constructor\]$/,Qr=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function ct(t,e){var r=function(n,o){return n==null?void 0:n[o]}(t,e);return function(n){return!(!st(n)||(o=n,Se&&Se in o))&&(ur(n)?Qr:Yr).test(at(n));var o}(r)?r:void 0}var xe,Ut,Ht,Zt=ct(Q,"WeakMap"),Oe=Object.create,Xr=function(){function t(){}return function(e){if(!st(e))return{};if(Oe)return Oe(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}(),Zr=Date.now,Kr=function(){try{var t=ct(Object,"defineProperty");return t({},"",{}),t}catch{}}(),Pt=Kr,tn=Pt?function(t,e){return Pt(t,"toString",{configurable:!0,enumerable:!1,value:(r=e,function(){return r}),writable:!0});var r}:Wt,en=(xe=tn,Ut=0,Ht=0,function(){var t=Zr(),e=16-(t-Ht);if(Ht=t,e>0){if(++Ut>=800)return arguments[0]}else Ut=0;return xe.apply(void 0,arguments)});function rn(t){return t!=t}function nn(t,e){return!(t==null||!t.length)&&function(r,n,o){return n==n?function(s,c,p){for(var u=-1,h=s.length;++u<h;)if(s[u]===c)return u;return-1}(r,n):function(s,c,p,u){for(var h=s.length,l=-1;++l<h;)if(c(s[l],l,s))return l;return-1}(r,rn)}(t,e)>-1}var on=9007199254740991,sn=/^(?:0|[1-9]\d*)$/;function ce(t,e){var r=typeof t;return!!(e=e??on)&&(r=="number"||r!="symbol"&&sn.test(t))&&t>-1&&t%1==0&&t<e}function ue(t,e,r){e=="__proto__"&&Pt?Pt(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}function qt(t,e){return t===e||t!=t&&e!=e}var an=Object.prototype.hasOwnProperty;function lr(t,e,r){var n=t[e];an.call(t,e)&&qt(n,r)&&(r!==void 0||e in t)||ue(t,e,r)}function Ct(t,e,r,n){var o=!r;r||(r={});for(var s=-1,c=e.length;++s<c;){var p=e[s],u=void 0;u===void 0&&(u=t[p]),o?ue(r,p,u):lr(r,p,u)}return r}var Ee=Math.max;function hr(t,e){return en(function(r,n,o){return n=Ee(n===void 0?r.length-1:n,0),function(){for(var s=arguments,c=-1,p=Ee(s.length-n,0),u=Array(p);++c<p;)u[c]=s[n+c];c=-1;for(var h=Array(n+1);++c<n;)h[c]=s[c];return h[n]=o(u),function(l,w,g){switch(g.length){case 0:return l.call(w);case 1:return l.call(w,g[0]);case 2:return l.call(w,g[0],g[1]);case 3:return l.call(w,g[0],g[1],g[2])}return l.apply(w,g)}(r,this,h)}}(t,e,Wt),t+"")}var cn=9007199254740991;function le(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=cn}function vt(t){return t!=null&&le(t.length)&&!ur(t)}function ke(t,e,r){if(!st(r))return!1;var n=typeof e;return!!(n=="number"?vt(r)&&ce(e,r.length):n=="string"&&e in r)&&qt(r[e],t)}var un=Object.prototype;function he(t){var e=t&&t.constructor;return t===(typeof e=="function"&&e.prototype||un)}function Ae(t){return et(t)&&mt(t)=="[object Arguments]"}var dr=Object.prototype,ln=dr.hasOwnProperty,hn=dr.propertyIsEnumerable,de=Ae(function(){return arguments}())?Ae:function(t){return et(t)&&ln.call(t,"callee")&&!hn.call(t,"callee")},fr=typeof R=="object"&&R&&!R.nodeType&&R,ze=fr&&typeof U=="object"&&U&&!U.nodeType&&U,Ce=ze&&ze.exports===fr?Q.Buffer:void 0,Lt=(Ce?Ce.isBuffer:void 0)||function(){return!1},N={};function Vt(t){return function(e){return t(e)}}N["[object Float32Array]"]=N["[object Float64Array]"]=N["[object Int8Array]"]=N["[object Int16Array]"]=N["[object Int32Array]"]=N["[object Uint8Array]"]=N["[object Uint8ClampedArray]"]=N["[object Uint16Array]"]=N["[object Uint32Array]"]=!0,N["[object Arguments]"]=N["[object Array]"]=N["[object ArrayBuffer]"]=N["[object Boolean]"]=N["[object DataView]"]=N["[object Date]"]=N["[object Error]"]=N["[object Function]"]=N["[object Map]"]=N["[object Number]"]=N["[object Object]"]=N["[object RegExp]"]=N["[object Set]"]=N["[object String]"]=N["[object WeakMap]"]=!1;var pr=typeof R=="object"&&R&&!R.nodeType&&R,jt=pr&&typeof U=="object"&&U&&!U.nodeType&&U,Jt=jt&&jt.exports===pr&&sr.process,wt=function(){try{return jt&&jt.require&&jt.require("util").types||Jt&&Jt.binding&&Jt.binding("util")}catch{}}(),$e=wt&&wt.isTypedArray,gr=$e?Vt($e):function(t){return et(t)&&le(t.length)&&!!N[mt(t)]},dn=Object.prototype.hasOwnProperty;function wr(t,e){var r=W(t),n=!r&&de(t),o=!r&&!n&&Lt(t),s=!r&&!n&&!o&&gr(t),c=r||n||o||s,p=c?function(l,w){for(var g=-1,y=Array(l);++g<l;)y[g]=w(g);return y}(t.length,String):[],u=p.length;for(var h in t)!e&&!dn.call(t,h)||c&&(h=="length"||o&&(h=="offset"||h=="parent")||s&&(h=="buffer"||h=="byteLength"||h=="byteOffset")||ce(h,u))||p.push(h);return p}function mr(t,e){return function(r){return t(e(r))}}var fn=mr(Object.keys,Object),pn=Object.prototype.hasOwnProperty;function Et(t){return vt(t)?wr(t):function(e){if(!he(e))return fn(e);var r=[];for(var n in Object(e))pn.call(e,n)&&n!="constructor"&&r.push(n);return r}(t)}var gn=Object.prototype.hasOwnProperty;function wn(t){return vt(t)?wr(t,!0):function(e){if(!st(e))return function(s){var c=[];if(s!=null)for(var p in Object(s))c.push(p);return c}(e);var r=he(e),n=[];for(var o in e)(o!="constructor"||!r&&gn.call(e,o))&&n.push(o);return n}(t)}var mn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,vn=/^\w*$/;function Kt(t,e){if(W(t))return!1;var r=typeof t;return!(r!="number"&&r!="symbol"&&r!="boolean"&&t!=null&&!gt(t))||vn.test(t)||!mn.test(t)||e!=null&&t in Object(e)}var _t=ct(Object,"create"),yn=Object.prototype.hasOwnProperty,bn=Object.prototype.hasOwnProperty;function it(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function $t(t,e){for(var r=t.length;r--;)if(qt(t[r][0],e))return r;return-1}it.prototype.clear=function(){this.__data__=_t?_t(null):{},this.size=0},it.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},it.prototype.get=function(t){var e=this.__data__;if(_t){var r=e[t];return r==="__lodash_hash_undefined__"?void 0:r}return yn.call(e,t)?e[t]:void 0},it.prototype.has=function(t){var e=this.__data__;return _t?e[t]!==void 0:bn.call(e,t)},it.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=_t&&e===void 0?"__lodash_hash_undefined__":e,this};var _n=Array.prototype.splice;function tt(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}tt.prototype.clear=function(){this.__data__=[],this.size=0},tt.prototype.delete=function(t){var e=this.__data__,r=$t(e,t);return!(r<0||(r==e.length-1?e.pop():_n.call(e,r,1),--this.size,0))},tt.prototype.get=function(t){var e=this.__data__,r=$t(e,t);return r<0?void 0:e[r][1]},tt.prototype.has=function(t){return $t(this.__data__,t)>-1},tt.prototype.set=function(t,e){var r=this.__data__,n=$t(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};var xt=ct(Q,"Map");function Mt(t,e){var r,n,o=t.__data__;return((n=typeof(r=e))=="string"||n=="number"||n=="symbol"||n=="boolean"?r!=="__proto__":r===null)?o[typeof e=="string"?"string":"hash"]:o.map}function K(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function fe(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError("Expected a function");var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],s=r.cache;if(s.has(o))return s.get(o);var c=t.apply(this,n);return r.cache=s.set(o,c)||s,c};return r.cache=new(fe.Cache||K),r}K.prototype.clear=function(){this.size=0,this.__data__={hash:new it,map:new(xt||tt),string:new it}},K.prototype.delete=function(t){var e=Mt(this,t).delete(t);return this.size-=e?1:0,e},K.prototype.get=function(t){return Mt(this,t).get(t)},K.prototype.has=function(t){return Mt(this,t).has(t)},K.prototype.set=function(t,e){var r=Mt(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this},fe.Cache=K;var Gt,Yt,jn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Sn=/\\(\\)?/g,xn=(Gt=fe(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(jn,function(r,n,o,s){e.push(o?s.replace(Sn,"$1"):n||r)}),e},function(t){return Yt.size===500&&Yt.clear(),t}),Yt=Gt.cache,Gt);function vr(t,e){return W(t)?t:Kt(t,e)?[t]:xn(function(r){return r==null?"":cr(r)}(t))}var On=1/0;function Tt(t){if(typeof t=="string"||gt(t))return t;var e=t+"";return e=="0"&&1/t==-On?"-0":e}function te(t,e){for(var r=0,n=(e=vr(e,t)).length;t!=null&&r<n;)t=t[Tt(e[r++])];return r&&r==n?t:void 0}function pe(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}var Me=J?J.isConcatSpreadable:void 0;function En(t){return W(t)||de(t)||!!(Me&&t&&t[Me])}function kn(t,e,r,n,o){var s=-1,c=t.length;for(r||(r=En),o||(o=[]);++s<c;){var p=t[s];r(p)?pe(o,p):o[o.length]=p}return o}var yr=mr(Object.getPrototypeOf,Object);function Y(t){var e=this.__data__=new tt(t);this.size=e.size}Y.prototype.clear=function(){this.__data__=new tt,this.size=0},Y.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},Y.prototype.get=function(t){return this.__data__.get(t)},Y.prototype.has=function(t){return this.__data__.has(t)},Y.prototype.set=function(t,e){var r=this.__data__;if(r instanceof tt){var n=r.__data__;if(!xt||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new K(n)}return r.set(t,e),this.size=r.size,this};var br=typeof R=="object"&&R&&!R.nodeType&&R,Ie=br&&typeof U=="object"&&U&&!U.nodeType&&U,Ne=Ie&&Ie.exports===br?Q.Buffer:void 0,Te=Ne?Ne.allocUnsafe:void 0;function _r(){return[]}var An=Object.prototype.propertyIsEnumerable,Fe=Object.getOwnPropertySymbols,zn=Fe?function(t){return t==null?[]:(t=Object(t),function(e,r){for(var n=-1,o=e==null?0:e.length,s=0,c=[];++n<o;){var p=e[n];An.call(t,p)&&(c[s++]=p)}return c}(Fe(t)))}:_r,ge=zn,Cn=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)pe(e,ge(t)),t=yr(t);return e}:_r;function $n(t,e,r){var n=e(t);return W(t)?n:pe(n,r(t))}function ee(t){return $n(t,Et,ge)}var re=ct(Q,"DataView"),ne=ct(Q,"Promise"),oe=ct(Q,"Set"),Pe="[object Map]",Le="[object Promise]",De="[object Set]",We="[object WeakMap]",qe="[object DataView]",Mn=at(re),In=at(xt),Nn=at(ne),Tn=at(oe),Fn=at(Zt),ot=mt;(re&&ot(new re(new ArrayBuffer(1)))!=qe||xt&&ot(new xt)!=Pe||ne&&ot(ne.resolve())!=Le||oe&&ot(new oe)!=De||Zt&&ot(new Zt)!=We)&&(ot=function(t){var e=mt(t),r=e=="[object Object]"?t.constructor:void 0,n=r?at(r):"";if(n)switch(n){case Mn:return qe;case In:return Pe;case Nn:return Le;case Tn:return De;case Fn:return We}return e});var Ot=ot,Pn=Object.prototype.hasOwnProperty,Dt=Q.Uint8Array;function Ln(t){var e=new t.constructor(t.byteLength);return new Dt(e).set(new Dt(t)),e}var Dn=/\w*$/,Ve=J?J.prototype:void 0,Be=Ve?Ve.valueOf:void 0,Wn="[object Boolean]",qn="[object Date]",Vn="[object Map]",Bn="[object Number]",Rn="[object RegExp]",Un="[object Set]",Hn="[object String]",Jn="[object Symbol]",Gn="[object ArrayBuffer]",Yn="[object DataView]",Qn="[object Float32Array]",Xn="[object Float64Array]",Zn="[object Int8Array]",Kn="[object Int16Array]",to="[object Int32Array]",eo="[object Uint8Array]",ro="[object Uint8ClampedArray]",no="[object Uint16Array]",oo="[object Uint32Array]",Re=wt&&wt.isMap,io=Re?Vt(Re):function(t){return et(t)&&Ot(t)=="[object Map]"},Ue=wt&&wt.isSet,so=Ue?Vt(Ue):function(t){return et(t)&&Ot(t)=="[object Set]"},ao=1,co=2,jr="[object Arguments]",Sr="[object Function]",uo="[object GeneratorFunction]",xr="[object Object]",I={};function Ft(t,e,r,n,o,s){var c,p=e&ao,u=e&co;if(c!==void 0)return c;if(!st(t))return t;var h=W(t);if(h){if(c=function(d){var m=d.length,j=new d.constructor(m);return m&&typeof d[0]=="string"&&Pn.call(d,"index")&&(j.index=d.index,j.input=d.input),j}(t),!p)return function(d,m){var j=-1,x=d.length;for(m||(m=Array(x));++j<x;)m[j]=d[j];return m}(t,c)}else{var l=Ot(t),w=l==Sr||l==uo;if(Lt(t))return function(d,m){var j=d.length,x=Te?Te(j):new d.constructor(j);return d.copy(x),x}(t);if(l==xr||l==jr||w&&!o){if(c=w?{}:function(d){return typeof d.constructor!="function"||he(d)?{}:Xr(yr(d))}(t),!p)return u?function(d,m){return Ct(d,Cn(d),m)}(t,function(d,m){return d&&Ct(m,wn(m),d)}(c,t)):function(d,m){return Ct(d,ge(d),m)}(t,function(d,m){return d&&Ct(m,Et(m),d)}(c,t))}else{if(!I[l])return o?t:{};c=function(d,m,j){var x,z,T=d.constructor;switch(m){case Gn:return Ln(d);case Wn:case qn:return new T(+d);case Yn:return function(k,F){var S=k.buffer;return new k.constructor(S,k.byteOffset,k.byteLength)}(d);case Qn:case Xn:case Zn:case Kn:case to:case eo:case ro:case no:case oo:return function(k,F){var S=k.buffer;return new k.constructor(S,k.byteOffset,k.length)}(d);case Vn:return new T;case Bn:case Hn:return new T(d);case Rn:return(z=new(x=d).constructor(x.source,Dn.exec(x))).lastIndex=x.lastIndex,z;case Un:return new T;case Jn:return Be?Object(Be.call(d)):{}}}(t,l)}}s||(s=new Y);var g=s.get(t);if(g)return g;s.set(t,c),so(t)?t.forEach(function(d){c.add(Ft(d,e,r,d,t,s))}):io(t)&&t.forEach(function(d,m){c.set(m,Ft(d,e,r,m,t,s))});var y=h?void 0:ee(t);return function(d,m){for(var j=-1,x=d==null?0:d.length;++j<x&&m(d[j],j)!==!1;);}(y||t,function(d,m){y&&(d=t[m=d]),lr(c,m,Ft(d,e,r,m,t,s))}),c}function Qt(t){return Ft(t,4)}function St(t){var e=-1,r=t==null?0:t.length;for(this.__data__=new K;++e<r;)this.add(t[e])}function lo(t,e){for(var r=-1,n=t==null?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}function ie(t,e){return t.has(e)}I[jr]=I["[object Array]"]=I["[object ArrayBuffer]"]=I["[object DataView]"]=I["[object Boolean]"]=I["[object Date]"]=I["[object Float32Array]"]=I["[object Float64Array]"]=I["[object Int8Array]"]=I["[object Int16Array]"]=I["[object Int32Array]"]=I["[object Map]"]=I["[object Number]"]=I[xr]=I["[object RegExp]"]=I["[object Set]"]=I["[object String]"]=I["[object Symbol]"]=I["[object Uint8Array]"]=I["[object Uint8ClampedArray]"]=I["[object Uint16Array]"]=I["[object Uint32Array]"]=!0,I["[object Error]"]=I[Sr]=I["[object WeakMap]"]=!1,St.prototype.add=St.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},St.prototype.has=function(t){return this.__data__.has(t)};var ho=1,fo=2;function He(t,e,r,n,o,s){var c=r&ho,p=t.length,u=e.length;if(p!=u&&!(c&&u>p))return!1;var h=s.get(t),l=s.get(e);if(h&&l)return h==e&&l==t;var w=-1,g=!0,y=r&fo?new St:void 0;for(s.set(t,e),s.set(e,t);++w<p;){var d=t[w],m=e[w];if(n)var j=c?n(m,d,w,e,t,s):n(d,m,w,t,e,s);if(j!==void 0){if(j)continue;g=!1;break}if(y){if(!lo(e,function(x,z){if(!ie(y,z)&&(d===x||o(d,x,r,n,s)))return y.push(z)})){g=!1;break}}else if(d!==m&&!o(d,m,r,n,s)){g=!1;break}}return s.delete(t),s.delete(e),g}function po(t){var e=-1,r=Array(t.size);return t.forEach(function(n,o){r[++e]=[o,n]}),r}function go(t){var e=-1,r=Array(t.size);return t.forEach(function(n){r[++e]=n}),r}var wo=1,mo=2,vo="[object Boolean]",yo="[object Date]",bo="[object Error]",_o="[object Map]",jo="[object Number]",So="[object RegExp]",xo="[object Set]",Oo="[object String]",Eo="[object Symbol]",ko="[object ArrayBuffer]",Ao="[object DataView]",Je=J?J.prototype:void 0,Xt=Je?Je.valueOf:void 0,zo=1,Co=Object.prototype.hasOwnProperty,$o=1,Ge="[object Arguments]",Ye="[object Array]",It="[object Object]",Qe=Object.prototype.hasOwnProperty;function se(t,e,r,n,o){return t===e||(t==null||e==null||!et(t)&&!et(e)?t!=t&&e!=e:function(s,c,p,u,h,l){var w=W(s),g=W(c),y=w?Ye:Ot(s),d=g?Ye:Ot(c),m=(y=y==Ge?It:y)==It,j=(d=d==Ge?It:d)==It,x=y==d;if(x&&Lt(s)){if(!Lt(c))return!1;w=!0,m=!1}if(x&&!m)return l||(l=new Y),w||gr(s)?He(s,c,p,u,h,l):function(S,E,P,q,rt,V,H){switch(P){case Ao:if(S.byteLength!=E.byteLength||S.byteOffset!=E.byteOffset)return!1;S=S.buffer,E=E.buffer;case ko:return!(S.byteLength!=E.byteLength||!V(new Dt(S),new Dt(E)));case vo:case yo:case jo:return qt(+S,+E);case bo:return S.name==E.name&&S.message==E.message;case So:case Oo:return S==E+"";case _o:var G=po;case xo:if(G||(G=go),S.size!=E.size&&!(q&wo))return!1;var X=H.get(S);if(X)return X==E;q|=mo,H.set(S,E);var Z=He(G(S),G(E),q,rt,V,H);return H.delete(S),Z;case Eo:if(Xt)return Xt.call(S)==Xt.call(E)}return!1}(s,c,y,p,u,h,l);if(!(p&$o)){var z=m&&Qe.call(s,"__wrapped__"),T=j&&Qe.call(c,"__wrapped__");if(z||T){var k=z?s.value():s,F=T?c.value():c;return l||(l=new Y),h(k,F,p,u,l)}}return!!x&&(l||(l=new Y),function(S,E,P,q,rt,V){var H=P&zo,G=ee(S),X=G.length;if(X!=ee(E).length&&!H)return!1;for(var Z=X;Z--;){var f=G[Z];if(!(H?f in E:Co.call(E,f)))return!1}var i=V.get(S),a=V.get(E);if(i&&a)return i==E&&a==S;var v=!0;V.set(S,E),V.set(E,S);for(var b=H;++Z<X;){var _=S[f=G[Z]],O=E[f];if(q)var $=H?q(O,_,f,E,S,V):q(_,O,f,S,E,V);if(!($===void 0?_===O||rt(_,O,P,q,V):$)){v=!1;break}b||(b=f=="constructor")}if(v&&!b){var D=S.constructor,M=E.constructor;D==M||!("constructor"in S)||!("constructor"in E)||typeof D=="function"&&D instanceof D&&typeof M=="function"&&M instanceof M||(v=!1)}return V.delete(S),V.delete(E),v}(s,c,p,u,h,l))}(t,e,r,n,se,o))}var Mo=1,Io=2;function Xe(t){return t==t&&!st(t)}function Ze(t,e){return function(r){return r!=null&&r[t]===e&&(e!==void 0||t in Object(r))}}function No(t,e){return t!=null&&e in Object(t)}var To=1,Fo=2;function ut(t){return typeof t=="function"?t:t==null?Wt:typeof t=="object"?W(t)?function(s,c){return Kt(s)&&Xe(c)?Ze(Tt(s),c):function(p){var u=function(h,l,w){var g=h==null?void 0:te(h,l);return g===void 0?void 0:g}(p,s);return u===void 0&&u===c?function(h,l){return h!=null&&function(w,g,y){for(var d=-1,m=(g=vr(g,w)).length,j=!1;++d<m;){var x=Tt(g[d]);if(!(j=w!=null&&y(w,x)))break;w=w[x]}return j||++d!=m?j:!!(m=w==null?0:w.length)&&le(m)&&ce(x,m)&&(W(w)||de(w))}(h,l,No)}(p,s):se(c,u,To|Fo)}}(t[0],t[1]):(o=function(s){for(var c=Et(s),p=c.length;p--;){var u=c[p],h=s[u];c[p]=[u,h,Xe(h)]}return c}(n=t),o.length==1&&o[0][2]?Ze(o[0][0],o[0][1]):function(s){return s===n||function(c,p,u,h){var l=u.length,w=l;if(c==null)return!w;for(c=Object(c);l--;){var g=u[l];if(g[2]?g[1]!==c[g[0]]:!(g[0]in c))return!1}for(;++l<w;){var y=(g=u[l])[0],d=c[y],m=g[1];if(g[2]){if(d===void 0&&!(y in c))return!1}else{var j=new Y;if(!se(m,d,Mo|Io,void 0,j))return!1}}return!0}(s,0,o)}):Kt(e=t)?(r=Tt(e),function(s){return s==null?void 0:s[r]}):function(s){return function(c){return te(c,s)}}(e);var e,r,n,o}var Po=function(t,e,r){for(var n=-1,o=Object(t),s=r(t),c=s.length;c--;){var p=s[++n];if(e(o[p],p,o)===!1)break}return t};function Or(t,e){return t&&Po(t,e,Et)}var Ke,Lo=(Ke=Or,function(t,e){if(t==null)return t;if(!vt(t))return Ke(t,e);for(var r=t.length,n=-1,o=Object(t);++n<r&&e(o[n],n,o)!==!1;);return t});function Er(t,e){var r=-1,n=vt(t)?Array(t.length):[];return Lo(t,function(o,s,c){n[++r]=e(o,s,c)}),n}function Do(t,e){return t>e}var Wo=Math.min;function qo(t){return function(e){return et(e)&&vt(e)}(t)?t:[]}var Vo=hr(function(t){var e=pt(t,qo);return e.length&&e[0]===t[0]?function(r,n,o){for(var s=nn,c=r[0].length,p=r.length,u=p,h=Array(p),l=1/0,w=[];u--;){var g=r[u];l=Wo(g.length,l),h[u]=c>=120&&g.length>=120?new St(u&&g):void 0}g=r[0];var y=-1,d=h[0];t:for(;++y<c&&w.length<l;){var m=g[y],j=m;if(m=m!==0?m:0,!(d?ie(d,j):s(w,j,o))){for(u=p;--u;){var x=h[u];if(!(x?ie(x,j):s(r[u],j,o)))continue t}d&&d.push(j),w.push(m)}}return w}(e):[]}),Bo=Vo;function Ro(t,e){return t<e}function C(t,e){var r={};return e=ut(e),Or(t,function(n,o,s){ue(r,o,e(n,o,s))}),r}function kr(t,e,r){for(var n=-1,o=t.length;++n<o;){var s=t[n],c=e(s);if(c!=null&&(p===void 0?c==c&&!gt(c):r(c,p)))var p=c,u=s}return u}function Uo(t,e){return t&&t.length?kr(t,ut(e),Do):void 0}function Ar(t,e){for(var r,n=-1,o=t.length;++n<o;){var s=e(t[n]);s!==void 0&&(r=r===void 0?s:r+s)}return r}function Ho(t,e){return function(r,n){var o=r==null?0:r.length;return o?Ar(r,n)/o:NaN}(t,ut(e))}function Jo(t,e){if(t!==e){var r=t!==void 0,n=t===null,o=t==t,s=gt(t),c=e!==void 0,p=e===null,u=e==e,h=gt(e);if(!p&&!h&&!s&&t>e||s&&c&&u&&!p&&!h||n&&c&&u||!r&&u||!o)return 1;if(!n&&!s&&!h&&t<e||h&&r&&o&&!n&&!s||p&&r&&o||!c&&o||!u)return-1}return 0}function zr(t,e,r){e=e.length?pt(e,function(o){return W(o)?function(s){return te(s,o.length===1?o[0]:o)}:o}):[Wt];var n=-1;return e=pt(e,Vt(ut)),function(o,s){var c=o.length;for(o.sort(function(p,u){return function(h,l,w){for(var g=-1,y=h.criteria,d=l.criteria,m=y.length,j=w.length;++g<m;){var x=Jo(y[g],d[g]);if(x)return g>=j?x:x*(w[g]=="desc"?-1:1)}return h.index-l.index}(p,u,r)});c--;)o[c]=o[c].value;return o}(Er(t,function(o,s,c){return{criteria:pt(e,function(p){return p(o)}),index:++n,value:o}}))}function we(t,e,r,n){return t==null?[]:(W(e)||(e=e==null?[]:[e]),W(r=r)||(r=r==null?[]:[r]),zr(t,e,r))}var Go=hr(function(t,e){if(t==null)return[];var r=e.length;return r>1&&ke(t,e[0],e[1])?e=[]:r>2&&ke(e[0],e[1],e[2])&&(e=[e[0]]),zr(t,kn(e),[])});function Yo(t,e){return t&&t.length?Ar(t,ut(e)):0}function A(t){if(this.words=[],t)if(Symbol&&Symbol.iterator&&t[Symbol.iterator]!==void 0){const e=t[Symbol.iterator]();let r=e.next();for(;!r.done;)this.add(r.value),r=e.next()}else for(let e=0;e<t.length;e++)this.add(t[e])}A.fromWords=function(t){const e=Object.create(A.prototype);return e.words=t,e},A.prototype.add=function(t){this.resize(t),this.words[t>>>5]|=1<<t},A.prototype.flip=function(t){this.resize(t),this.words[t>>>5]^=1<<t},A.prototype.clear=function(){this.words.length=0},A.prototype.remove=function(t){this.resize(t),this.words[t>>>5]&=~(1<<t)},A.prototype.isEmpty=function(t){const e=this.words.length;for(let r=0;r<e;r++)if(this.words[r]!==0)return!1;return!0},A.prototype.has=function(t){return(this.words[t>>>5]&1<<t)!=0},A.prototype.checkedAdd=function(t){this.resize(t);const e=this.words[t>>>5],r=e|1<<t;return this.words[t>>>5]=r,(r^e)>>>t},A.prototype.trim=function(t){let e=this.words.length;for(;e>0&&this.words[e-1]===0;)e--;this.words.length=e},A.prototype.resize=function(t){const e=t+32>>>5;for(let r=this.words.length;r<e;r++)this.words[r]=0},A.prototype.hammingWeight=function(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24},A.prototype.hammingWeight4=function(t,e,r,n){return 16843009*((t=(t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)+(e=(e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)+(r=(r=(858993459&(r-=r>>>1&1431655765))+(r>>>2&858993459))+(r>>>4)&252645135)+(n=(n=(858993459&(n-=n>>>1&1431655765))+(n>>>2&858993459))+(n>>>4)&252645135))>>>24},A.prototype.size=function(){let t=0;const e=this.words.length,r=this.words;for(let n=0;n<e;n++)t+=this.hammingWeight(r[n]);return t},A.prototype.array=function(){const t=new Array(this.size());let e=0;const r=this.words.length;for(let n=0;n<r;++n){let o=this.words[n];for(;o!=0;){const s=o&-o;t[e++]=(n<<5)+this.hammingWeight(s-1|0),o^=s}}return t},A.prototype.forEach=function(t){const e=this.words.length;for(let r=0;r<e;++r){let n=this.words[r];for(;n!=0;){const o=n&-n;t((r<<5)+this.hammingWeight(o-1|0)),n^=o}}},A.prototype[Symbol.iterator]=function(){const t=this.words.length;let e=0,r=this.words[e],n=this.hammingWeight,o=this.words;return{[Symbol.iterator](){return this},next(){for(;e<t;){if(r!==0){const s=r&-r,c=(e<<5)+n(s-1|0);return r^=s,{done:!1,value:c}}e++,e<t&&(r=o[e])}return{done:!0,value:void 0}}}},A.prototype.clone=function(){const t=Object.create(A.prototype);return t.words=this.words.slice(),t},A.prototype.intersects=function(t){const e=Math.min(this.words.length,t.words.length);for(let r=0;r<e;++r)if(this.words[r]&t.words[r])return!0;return!1},A.prototype.intersection=function(t){const e=Math.min(this.words.length,t.words.length);let r=0;for(;r+7<e;r+=8)this.words[r]&=t.words[r],this.words[r+1]&=t.words[r+1],this.words[r+2]&=t.words[r+2],this.words[r+3]&=t.words[r+3],this.words[r+4]&=t.words[r+4],this.words[r+5]&=t.words[r+5],this.words[r+6]&=t.words[r+6],this.words[r+7]&=t.words[r+7];for(;r<e;++r)this.words[r]&=t.words[r];const n=this.words.length;for(r=e;r<n;++r)this.words[r]=0;return this},A.prototype.intersection_size=function(t){const e=Math.min(this.words.length,t.words.length);let r=0;for(let n=0;n<e;++n)r+=this.hammingWeight(this.words[n]&t.words[n]);return r},A.prototype.new_intersection=function(t){const e=Object.create(A.prototype),r=Math.min(this.words.length,t.words.length);e.words=new Array(r);let n=0;for(;n+7<r;n+=8)e.words[n]=this.words[n]&t.words[n],e.words[n+1]=this.words[n+1]&t.words[n+1],e.words[n+2]=this.words[n+2]&t.words[n+2],e.words[n+3]=this.words[n+3]&t.words[n+3],e.words[n+4]=this.words[n+4]&t.words[n+4],e.words[n+5]=this.words[n+5]&t.words[n+5],e.words[n+6]=this.words[n+6]&t.words[n+6],e.words[n+7]=this.words[n+7]&t.words[n+7];for(;n<r;++n)e.words[n]=this.words[n]&t.words[n];return e},A.prototype.equals=function(t){const e=Math.min(this.words.length,t.words.length);for(let r=0;r<e;++r)if(this.words[r]!=t.words[r])return!1;if(this.words.length<t.words.length){const r=t.words.length;for(let n=this.words.length;n<r;++n)if(t.words[n]!=0)return!1}else if(t.words.length<this.words.length){const r=this.words.length;for(let n=t.words.length;n<r;++n)if(this.words[n]!=0)return!1}return!0},A.prototype.difference=function(t){const e=Math.min(this.words.length,t.words.length);let r=0;for(;r+7<e;r+=8)this.words[r]&=~t.words[r],this.words[r+1]&=~t.words[r+1],this.words[r+2]&=~t.words[r+2],this.words[r+3]&=~t.words[r+3],this.words[r+4]&=~t.words[r+4],this.words[r+5]&=~t.words[r+5],this.words[r+6]&=~t.words[r+6],this.words[r+7]&=~t.words[r+7];for(;r<e;++r)this.words[r]&=~t.words[r];return this},A.prototype.new_difference=function(t){return this.clone().difference(t)},A.prototype.difference2=function(t){const e=Math.min(this.words.length,t.words.length);let r=0;for(;r+7<e;r+=8)t.words[r]=this.words[r]&~t.words[r],t.words[r+1]=this.words[r+1]&~t.words[r+1],t.words[r+2]=this.words[r+2]&~t.words[r+2],t.words[r+3]=this.words[r+3]&~t.words[r+3],t.words[r+4]=this.words[r+4]&~t.words[r+4],t.words[r+5]=this.words[r+5]&~t.words[r+5],t.words[r+6]=this.words[r+6]&~t.words[r+6],t.words[r+7]=this.words[r+7]&~t.words[r+7];for(;r<e;++r)t.words[r]=this.words[r]&~t.words[r];for(r=this.words.length-1;r>=e;--r)t.words[r]=this.words[r];return t.words.length=this.words.length,t},A.prototype.difference_size=function(t){const e=Math.min(this.words.length,t.words.length);let r=0,n=0;for(;n<e;++n)r+=this.hammingWeight(this.words[n]&~t.words[n]);const o=this.words.length;for(;n<o;++n)r+=this.hammingWeight(this.words[n]);return r},A.prototype.change=function(t){const e=Math.min(this.words.length,t.words.length);let r=0;for(;r+7<e;r+=8)this.words[r]^=t.words[r],this.words[r+1]^=t.words[r+1],this.words[r+2]^=t.words[r+2],this.words[r+3]^=t.words[r+3],this.words[r+4]^=t.words[r+4],this.words[r+5]^=t.words[r+5],this.words[r+6]^=t.words[r+6],this.words[r+7]^=t.words[r+7];for(;r<e;++r)this.words[r]^=t.words[r];for(r=t.words.length-1;r>=e;--r)this.words[r]=t.words[r];return this},A.prototype.new_change=function(t){const e=Object.create(A.prototype),r=Math.max(this.words.length,t.words.length);e.words=new Array(r);const n=Math.min(this.words.length,t.words.length);let o=0;for(;o+7<n;o+=8)e.words[o]=this.words[o]^t.words[o],e.words[o+1]=this.words[o+1]^t.words[o+1],e.words[o+2]=this.words[o+2]^t.words[o+2],e.words[o+3]=this.words[o+3]^t.words[o+3],e.words[o+4]=this.words[o+4]^t.words[o+4],e.words[o+5]=this.words[o+5]^t.words[o+5],e.words[o+6]=this.words[o+6]^t.words[o+6],e.words[o+7]=this.words[o+7]^t.words[o+7];for(;o<n;++o)e.words[o]=this.words[o]^t.words[o];const s=this.words.length;for(o=n;o<s;++o)e.words[o]=this.words[o];const c=t.words.length;for(o=n;o<c;++o)e.words[o]=t.words[o];return e},A.prototype.change_size=function(t){const e=Math.min(this.words.length,t.words.length);let r=0,n=0;for(;n<e;++n)r+=this.hammingWeight(this.words[n]^t.words[n]);const o=this.words.length>t.words.length?this:t,s=o.words.length;for(;n<s;++n)r+=this.hammingWeight(o.words[n]);return r},A.prototype.toString=function(){return"{"+this.array().join(",")+"}"},A.prototype.union=function(t){const e=Math.min(this.words.length,t.words.length);let r=0;for(;r+7<e;r+=8)this.words[r]|=t.words[r],this.words[r+1]|=t.words[r+1],this.words[r+2]|=t.words[r+2],this.words[r+3]|=t.words[r+3],this.words[r+4]|=t.words[r+4],this.words[r+5]|=t.words[r+5],this.words[r+6]|=t.words[r+6],this.words[r+7]|=t.words[r+7];for(;r<e;++r)this.words[r]|=t.words[r];if(this.words.length<t.words.length){this.resize((t.words.length<<5)-1);const n=t.words.length;for(let o=e;o<n;++o)this.words[o]=t.words[o]}return this},A.prototype.new_union=function(t){const e=Object.create(A.prototype),r=Math.max(this.words.length,t.words.length);e.words=new Array(r);const n=Math.min(this.words.length,t.words.length);let o=0;for(;o+7<n;o+=8)e.words[o]=this.words[o]|t.words[o],e.words[o+1]=this.words[o+1]|t.words[o+1],e.words[o+2]=this.words[o+2]|t.words[o+2],e.words[o+3]=this.words[o+3]|t.words[o+3],e.words[o+4]=this.words[o+4]|t.words[o+4],e.words[o+5]=this.words[o+5]|t.words[o+5],e.words[o+6]=this.words[o+6]|t.words[o+6],e.words[o+7]=this.words[o+7]|t.words[o+7];for(;o<n;++o)e.words[o]=this.words[o]|t.words[o];const s=this.words.length;for(o=n;o<s;++o)e.words[o]=this.words[o];const c=t.words.length;for(o=n;o<c;++o)e.words[o]=t.words[o];return e},A.prototype.union_size=function(t){const e=Math.min(this.words.length,t.words.length);let r=0;for(let n=0;n<e;++n)r+=this.hammingWeight(this.words[n]|t.words[n]);if(this.words.length<t.words.length){const n=t.words.length;for(let o=this.words.length;o<n;++o)r+=this.hammingWeight(0|t.words[o])}else{const n=this.words.length;for(let o=t.words.length;o<n;++o)r+=this.hammingWeight(0|this.words[o])}return r};var B=A;function ae(){return ae=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},ae.apply(this,arguments)}function Qo(t,e){var r=[];return t.forEach(function(n){e.forEach(function(o){r.push(n.concat(o))})}),r}function Cr(t){return!!~t.search(/\(|\)/)}function tr(t,e){for(var r=e.split(" "+t+" "),n=[],o=[],s=0;s<r.length;s++)if(Cr(r[s])||o.length>0){o.push(r[s]);var c=""+o;(c.match(/\(/g)||[]).length===(c.match(/\)/g)||[]).length&&(n.push(o.join(" "+t+" ")),o=[])}else n.push(r[s]);return n}var Xo=function t(e){return function(n){for(var o=n[0],s=1;s<n.length;s++)o=o.concat(n[s]);return o}(tr("OR",(r=e=function(n){if(n.charAt(0)==="("){for(var o=0,s=0;s<n.length;s++)if(n.charAt(s)==="("?o++:n.charAt(s)===")"&&o--,o===0)return s!==n.length-1?n:n.substring(1,n.length-1)}return n}(e),e=r.replace(/[\s]+/g," "))).map(function(n){for(var o=tr("AND",n),s=[],c=[],p=0;p<o.length;p++)Cr(o[p])?s.push(t(o[p])):c.push(o[p]);return s.push([c]),function(u){for(var h=[[]],l=0;l<u.length;l++)h=Qo(h,u[l]);return h}(s)}));var r};const er=function(t){try{return structuredClone(t)}catch{try{return JSON.parse(JSON.stringify(t))}catch{return t}}},rr=function(t,e){let r=new B([]),n=0;return C(e,function(o,s){o.forEach(c=>{++n,r=r.new_union(t[s][c]||new B([]))})}),n===0?null:r},Zo=function(t,e,r){let n=1;return C(t.bits_data_temp,(o,s)=>{let c,p,u,h,l,w,g;r[s]&&(c=r[s].order,p=r[s].sort,u=r[s].size,h=r[s].title,l=r[s].show_facet_stats||!1,w=r[s].chosen_filters_on_top!==!1,g=r[s].hide_zero_doc_count||!1);let y,d,m,j,x=Object.entries(o).map(k=>{let F=[];e&&e.filters&&e.filters[s]&&(F=e.filters[s]);const S=k[1].array().length;if(!g||S!==0||F.indexOf(k[0])!==-1)return{key:k[0],doc_count:S,selected:F.indexOf(k[0])!==-1}}).filter(Boolean);var z,T;return W(p)?(y=p||["key"],d=c||["asc"]):(p==="term"||p==="key"?(y=["key"],d=[c||"asc"]):(y=["doc_count","key"],d=[c||"desc","asc"]),w&&(y.unshift("selected"),d.unshift("desc"))),x=we(x,y,d),x=x.slice(0,u||10),l&&(m=[],Object.entries(o).forEach(k=>{if(isNaN(k[0]))throw new Error("You cant use chars to calculate the facet_stats.");k[1].array().length>0&&k[1].forEach(()=>{m.push(parseInt(k[0]))})}),j={min:(z=m,z&&z.length?kr(z,ut(void 0),Ro):void 0),max:Uo(m),avg:Ho(m),sum:Yo(m)}),ae({name:s,title:h||(T=s,T.replace(/^[\s_]+|[\s_]+$/g,"").replace(/[_\s]+/g," ").replace(/^[a-z]/,function(k){return k.toUpperCase()})),position:n++,buckets:x},l&&{facet_stats:j})})};function nr(t,e,r,n,o){e=e||Object.create(null);const s=parseInt(e.per_page||12),c=parseInt(e.page||1),p=e.is_all_filtered_items||!1;if(r.native_search_enabled===!1&&(e.query||e.filter))throw new Error('"query" and "filter" options are not working once native search is disabled');let u=0;const h=new Date().getTime();let l,w,g,y=o.bits_ids();if(e._ids)l=new B(e._ids),w=e._ids;else if(e.ids)w=o.internal_ids_from_ids_map(e.ids),l=new B(w);else if(n&&(e.query||e.filter)){const S=new Date().getTime();w=n.search(e.query,e.filter),u=new Date().getTime()-S,l=new B(w)}let d=new Date().getTime();const m=o.search(e,{query_ids:l});d=new Date().getTime()-d,l&&(y=l),m.ids&&(y=y.new_intersection(m.ids)),m.not_ids&&(y=y.new_difference(m.not_ids));let j=y.array(),x=j.map(S=>o.get_item(S)),z=!1;const T=new Date().getTime();let k=0;e.sort?x=function(S,E,P){return P&&P[E]&&(E=P[E]),E.field?we(S,E.field,E.order||"asc"):S}(x,e.sort,r.sortings):w&&(j=w.filter(S=>y.has(S)),x=j.slice((c-1)*s,c*s).map(S=>o.get_item(S)),z=!0),z||(g=p?x:null,x=x.slice((c-1)*s,c*s)),k=new Date().getTime()-T;const F=new Date().getTime()-h;return{pagination:{per_page:s,page:c,total:j.length},timings:{total:F,facets:d,search:u,sorting:k},data:{items:x,allFilteredItems:g,aggregations:Zo(m,e,r.aggregations)}}}var Nt=function(t){var e={exports:{}};return function(r,n){(function(){var o,s,c,p,u,h,l,w,g,y,d,m,j,x,z,T,k,F,S,E,P,q,rt,V,H,G,X,Z,f=function(i){var a=new f.Index;return a.pipeline.add(f.trimmer,f.stopWordFilter,f.stemmer),i&&i.call(a,a),a};f.version="1.0.0",f.utils={},f.utils.warn=function(i){return function(a){i.console&&console.warn&&console.warn(a)}}(this),f.utils.asString=function(i){return i==null?"":i.toString()},f.EventEmitter=function(){this.events={}},f.EventEmitter.prototype.addListener=function(){var i=Array.prototype.slice.call(arguments),a=i.pop(),v=i;if(typeof a!="function")throw new TypeError("last argument must be a function");v.forEach(function(b){this.hasHandler(b)||(this.events[b]=[]),this.events[b].push(a)},this)},f.EventEmitter.prototype.removeListener=function(i,a){if(this.hasHandler(i)){var v=this.events[i].indexOf(a);this.events[i].splice(v,1),this.events[i].length||delete this.events[i]}},f.EventEmitter.prototype.emit=function(i){if(this.hasHandler(i)){var a=Array.prototype.slice.call(arguments,1);this.events[i].forEach(function(v){v.apply(void 0,a)})}},f.EventEmitter.prototype.hasHandler=function(i){return i in this.events},f.tokenizer=function(i){return arguments.length&&i!=null&&i!=null?Array.isArray(i)?i.map(function(a){return f.utils.asString(a).toLowerCase()}):i.toString().trim().toLowerCase().split(f.tokenizer.separator):[]},f.tokenizer.separator=/[\s\-]+/,f.tokenizer.load=function(i){var a=this.registeredFunctions[i];if(!a)throw new Error("Cannot load un-registered function: "+i);return a},f.tokenizer.label="default",f.tokenizer.registeredFunctions={default:f.tokenizer},f.tokenizer.registerFunction=function(i,a){a in this.registeredFunctions&&f.utils.warn("Overwriting existing tokenizer: "+a),i.label=a,this.registeredFunctions[a]=i},f.Pipeline=function(){this._stack=[]},f.Pipeline.registeredFunctions={},f.Pipeline.registerFunction=function(i,a){a in this.registeredFunctions&&f.utils.warn("Overwriting existing registered function: "+a),i.label=a,f.Pipeline.registeredFunctions[i.label]=i},f.Pipeline.warnIfFunctionNotRegistered=function(i){i.label&&i.label in this.registeredFunctions||f.utils.warn(`Function is not registered with pipeline. This may cause problems when serialising the index.
`,i)},f.Pipeline.load=function(i){var a=new f.Pipeline;return i.forEach(function(v){var b=f.Pipeline.registeredFunctions[v];if(!b)throw new Error("Cannot load un-registered function: "+v);a.add(b)}),a},f.Pipeline.prototype.add=function(){Array.prototype.slice.call(arguments).forEach(function(i){f.Pipeline.warnIfFunctionNotRegistered(i),this._stack.push(i)},this)},f.Pipeline.prototype.after=function(i,a){f.Pipeline.warnIfFunctionNotRegistered(a);var v=this._stack.indexOf(i);if(v==-1)throw new Error("Cannot find existingFn");this._stack.splice(v+=1,0,a)},f.Pipeline.prototype.before=function(i,a){f.Pipeline.warnIfFunctionNotRegistered(a);var v=this._stack.indexOf(i);if(v==-1)throw new Error("Cannot find existingFn");this._stack.splice(v,0,a)},f.Pipeline.prototype.remove=function(i){var a=this._stack.indexOf(i);a!=-1&&this._stack.splice(a,1)},f.Pipeline.prototype.run=function(i){for(var a=[],v=i.length,b=this._stack.length,_=0;_<v;_++){for(var O=i[_],$=0;$<b&&(O=this._stack[$](O,_,i))!==void 0&&O!=="";$++);O!==void 0&&O!==""&&a.push(O)}return a},f.Pipeline.prototype.reset=function(){this._stack=[]},f.Pipeline.prototype.toJSON=function(){return this._stack.map(function(i){return f.Pipeline.warnIfFunctionNotRegistered(i),i.label})},f.Vector=function(){this._magnitude=null,this.list=void 0,this.length=0},f.Vector.Node=function(i,a,v){this.idx=i,this.val=a,this.next=v},f.Vector.prototype.insert=function(i,a){this._magnitude=void 0;var v=this.list;if(!v)return this.list=new f.Vector.Node(i,a,v),this.length++;if(i<v.idx)return this.list=new f.Vector.Node(i,a,v),this.length++;for(var b=v,_=v.next;_!=null;){if(i<_.idx)return b.next=new f.Vector.Node(i,a,_),this.length++;b=_,_=_.next}return b.next=new f.Vector.Node(i,a,_),this.length++},f.Vector.prototype.magnitude=function(){if(this._magnitude)return this._magnitude;for(var i,a=this.list,v=0;a;)v+=(i=a.val)*i,a=a.next;return this._magnitude=Math.sqrt(v)},f.Vector.prototype.dot=function(i){for(var a=this.list,v=i.list,b=0;a&&v;)a.idx<v.idx?a=a.next:(a.idx>v.idx||(b+=a.val*v.val,a=a.next),v=v.next);return b},f.Vector.prototype.similarity=function(i){return this.dot(i)/(this.magnitude()*i.magnitude())},f.SortedSet=function(){this.length=0,this.elements=[]},f.SortedSet.load=function(i){var a=new this;return a.elements=i,a.length=i.length,a},f.SortedSet.prototype.add=function(){var i,a;for(i=0;i<arguments.length;i++)~this.indexOf(a=arguments[i])||this.elements.splice(this.locationFor(a),0,a);this.length=this.elements.length},f.SortedSet.prototype.toArray=function(){return this.elements.slice()},f.SortedSet.prototype.map=function(i,a){return this.elements.map(i,a)},f.SortedSet.prototype.forEach=function(i,a){return this.elements.forEach(i,a)},f.SortedSet.prototype.indexOf=function(i){for(var a=0,v=this.elements.length,b=v-a,_=a+Math.floor(b/2),O=this.elements[_];b>1;){if(O===i)return _;O<i&&(a=_),O>i&&(v=_),b=v-a,_=a+Math.floor(b/2),O=this.elements[_]}return O===i?_:-1},f.SortedSet.prototype.locationFor=function(i){for(var a=0,v=this.elements.length,b=v-a,_=a+Math.floor(b/2),O=this.elements[_];b>1;)O<i&&(a=_),O>i&&(v=_),b=v-a,_=a+Math.floor(b/2),O=this.elements[_];return O>i?_:O<i?_+1:void 0},f.SortedSet.prototype.intersect=function(i){for(var a=new f.SortedSet,v=0,b=0,_=this.length,O=i.length,$=this.elements,D=i.elements;!(v>_-1||b>O-1);)$[v]!==D[b]?$[v]<D[b]?v++:$[v]>D[b]&&b++:(a.add($[v]),v++,b++);return a},f.SortedSet.prototype.clone=function(){var i=new f.SortedSet;return i.elements=this.toArray(),i.length=i.elements.length,i},f.SortedSet.prototype.union=function(i){var a,v,b;this.length>=i.length?(a=this,v=i):(a=i,v=this),b=a.clone();for(var _=0,O=v.toArray();_<O.length;_++)b.add(O[_]);return b},f.SortedSet.prototype.toJSON=function(){return this.toArray()},f.Index=function(){this._fields=[],this._ref="id",this.pipeline=new f.Pipeline,this.documentStore=new f.Store,this.tokenStore=new f.TokenStore,this.corpusTokens=new f.SortedSet,this.eventEmitter=new f.EventEmitter,this.tokenizerFn=f.tokenizer,this._idfCache={},this.on("add","remove","update",(function(){this._idfCache={}}).bind(this))},f.Index.prototype.on=function(){var i=Array.prototype.slice.call(arguments);return this.eventEmitter.addListener.apply(this.eventEmitter,i)},f.Index.prototype.off=function(i,a){return this.eventEmitter.removeListener(i,a)},f.Index.load=function(i){i.version!==f.version&&f.utils.warn("version mismatch: current "+f.version+" importing "+i.version);var a=new this;return a._fields=i.fields,a._ref=i.ref,a.tokenizer(f.tokenizer.load(i.tokenizer)),a.documentStore=f.Store.load(i.documentStore),a.tokenStore=f.TokenStore.load(i.tokenStore),a.corpusTokens=f.SortedSet.load(i.corpusTokens),a.pipeline=f.Pipeline.load(i.pipeline),a},f.Index.prototype.field=function(i,a){return this._fields.push({name:i,boost:(a=a||{}).boost||1}),this},f.Index.prototype.ref=function(i){return this._ref=i,this},f.Index.prototype.tokenizer=function(i){return i.label&&i.label in f.tokenizer.registeredFunctions||f.utils.warn("Function is not a registered tokenizer. This may cause problems when serialising the index"),this.tokenizerFn=i,this},f.Index.prototype.add=function(i,a){var v={},b=new f.SortedSet,_=i[this._ref];a=a===void 0||a,this._fields.forEach(function(At){var dt=this.pipeline.run(this.tokenizerFn(i[At.name]));v[At.name]=dt;for(var ft=0;ft<dt.length;ft++){var zt=dt[ft];b.add(zt),this.corpusTokens.add(zt)}},this),this.documentStore.set(_,b);for(var O=0;O<b.length;O++){for(var $=b.elements[O],D=0,M=0;M<this._fields.length;M++){var lt=this._fields[M],kt=v[lt.name],yt=kt.length;if(yt){for(var nt=0,ht=0;ht<yt;ht++)kt[ht]===$&&nt++;D+=nt/yt*lt.boost}}this.tokenStore.add($,{ref:_,tf:D})}a&&this.eventEmitter.emit("add",i,this)},f.Index.prototype.remove=function(i,a){var v=i[this._ref];if(a=a===void 0||a,this.documentStore.has(v)){var b=this.documentStore.get(v);this.documentStore.remove(v),b.forEach(function(_){this.tokenStore.remove(_,v)},this),a&&this.eventEmitter.emit("remove",i,this)}},f.Index.prototype.update=function(i,a){a=a===void 0||a,this.remove(i,!1),this.add(i,!1),a&&this.eventEmitter.emit("update",i,this)},f.Index.prototype.idf=function(i){var a="@"+i;if(Object.prototype.hasOwnProperty.call(this._idfCache,a))return this._idfCache[a];var v=this.tokenStore.count(i),b=1;return v>0&&(b=1+Math.log(this.documentStore.length/v)),this._idfCache[a]=b},f.Index.prototype.search=function(i){var a=this.pipeline.run(this.tokenizerFn(i)),v=new f.Vector,b=[],_=this._fields.reduce(function(O,$){return O+$.boost},0);return a.some(function(O){return this.tokenStore.has(O)},this)?(a.forEach(function(O,$,D){var M=1/D.length*this._fields.length*_,lt=this,kt=this.tokenStore.expand(O).reduce(function(yt,nt){var ht=lt.corpusTokens.indexOf(nt),At=lt.idf(nt),dt=1,ft=new f.SortedSet;if(nt!==O){var zt=Math.max(3,nt.length-O.length);dt=1/Math.log(zt)}ht>-1&&v.insert(ht,M*At*dt);for(var me=lt.tokenStore.get(nt),ve=Object.keys(me),$r=ve.length,Bt=0;Bt<$r;Bt++)ft.add(me[ve[Bt]].ref);return yt.union(ft)},new f.SortedSet);b.push(kt)},this),b.reduce(function(O,$){return O.intersect($)}).map(function(O){return{ref:O,score:v.similarity(this.documentVector(O))}},this).sort(function(O,$){return $.score-O.score})):[]},f.Index.prototype.documentVector=function(i){for(var a=this.documentStore.get(i),v=a.length,b=new f.Vector,_=0;_<v;_++){var O=a.elements[_],$=this.tokenStore.get(O)[i].tf,D=this.idf(O);b.insert(this.corpusTokens.indexOf(O),$*D)}return b},f.Index.prototype.toJSON=function(){return{version:f.version,fields:this._fields,ref:this._ref,tokenizer:this.tokenizerFn.label,documentStore:this.documentStore.toJSON(),tokenStore:this.tokenStore.toJSON(),corpusTokens:this.corpusTokens.toJSON(),pipeline:this.pipeline.toJSON()}},f.Index.prototype.use=function(i){var a=Array.prototype.slice.call(arguments,1);a.unshift(this),i.apply(this,a)},f.Store=function(){this.store={},this.length=0},f.Store.load=function(i){var a=new this;return a.length=i.length,a.store=Object.keys(i.store).reduce(function(v,b){return v[b]=f.SortedSet.load(i.store[b]),v},{}),a},f.Store.prototype.set=function(i,a){this.has(i)||this.length++,this.store[i]=a},f.Store.prototype.get=function(i){return this.store[i]},f.Store.prototype.has=function(i){return i in this.store},f.Store.prototype.remove=function(i){this.has(i)&&(delete this.store[i],this.length--)},f.Store.prototype.toJSON=function(){return{store:this.store,length:this.length}},f.stemmer=(o={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},s={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},h="^("+(p="[^aeiou][^aeiouy]*")+")?"+(u=(c="[aeiouy]")+"[aeiou]*")+p+"("+u+")?$",l="^("+p+")?"+u+p+u+p,w="^("+p+")?"+c,g=new RegExp("^("+p+")?"+u+p),y=new RegExp(l),d=new RegExp(h),m=new RegExp(w),j=/^(.+?)(ss|i)es$/,x=/^(.+?)([^s])s$/,z=/^(.+?)eed$/,T=/^(.+?)(ed|ing)$/,k=/.$/,F=/(at|bl|iz)$/,S=new RegExp("([^aeiouylsz])\\1$"),E=new RegExp("^"+p+c+"[^aeiouwxy]$"),P=/^(.+?[^aeiou])y$/,q=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,rt=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,V=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,H=/^(.+?)(s|t)(ion)$/,G=/^(.+?)e$/,X=/ll$/,Z=new RegExp("^"+p+c+"[^aeiouwxy]$"),function(i){var a,v,b,_,O,$,D;if(i.length<3)return i;if((b=i.substr(0,1))=="y"&&(i=b.toUpperCase()+i.substr(1)),O=x,(_=j).test(i)?i=i.replace(_,"$1$2"):O.test(i)&&(i=i.replace(O,"$1$2")),O=T,(_=z).test(i)){var M=_.exec(i);(_=g).test(M[1])&&(i=i.replace(_=k,""))}else O.test(i)&&(M=O.exec(i),(O=m).test(a=M[1])&&($=S,D=E,(O=F).test(i=a)?i+="e":$.test(i)?i=i.replace(_=k,""):D.test(i)&&(i+="e")));return(_=P).test(i)&&(i=(a=(M=_.exec(i))[1])+"i"),(_=q).test(i)&&(v=(M=_.exec(i))[2],(_=g).test(a=M[1])&&(i=a+o[v])),(_=rt).test(i)&&(v=(M=_.exec(i))[2],(_=g).test(a=M[1])&&(i=a+s[v])),O=H,(_=V).test(i)?(M=_.exec(i),(_=y).test(a=M[1])&&(i=a)):O.test(i)&&(M=O.exec(i),(O=y).test(a=M[1]+M[2])&&(i=a)),(_=G).test(i)&&(M=_.exec(i),O=d,$=Z,((_=y).test(a=M[1])||O.test(a)&&!$.test(a))&&(i=a)),O=y,(_=X).test(i)&&O.test(i)&&(i=i.replace(_=k,"")),b=="y"&&(i=b.toLowerCase()+i.substr(1)),i}),f.Pipeline.registerFunction(f.stemmer,"stemmer"),f.generateStopWordFilter=function(i){var a=i.reduce(function(v,b){return v[b]=b,v},{});return function(v){if(v&&a[v]!==v)return v}},f.stopWordFilter=f.generateStopWordFilter(["a","able","about","across","after","all","almost","also","am","among","an","and","any","are","as","at","be","because","been","but","by","can","cannot","could","dear","did","do","does","either","else","ever","every","for","from","get","got","had","has","have","he","her","hers","him","his","how","however","i","if","in","into","is","it","its","just","least","let","like","likely","may","me","might","most","must","my","neither","no","nor","not","of","off","often","on","only","or","other","our","own","rather","said","say","says","she","should","since","so","some","than","that","the","their","them","then","there","these","they","this","tis","to","too","twas","us","wants","was","we","were","what","when","where","which","while","who","whom","why","will","with","would","yet","you","your"]),f.Pipeline.registerFunction(f.stopWordFilter,"stopWordFilter"),f.trimmer=function(i){return i.replace(/^\W+/,"").replace(/\W+$/,"")},f.Pipeline.registerFunction(f.trimmer,"trimmer"),f.TokenStore=function(){this.root={docs:{}},this.length=0},f.TokenStore.load=function(i){var a=new this;return a.root=i.root,a.length=i.length,a},f.TokenStore.prototype.add=function(i,a,v){v=v||this.root;var b=i.charAt(0),_=i.slice(1);return b in v||(v[b]={docs:{}}),_.length===0?(v[b].docs[a.ref]=a,void(this.length+=1)):this.add(_,a,v[b])},f.TokenStore.prototype.has=function(i){if(!i)return!1;for(var a=this.root,v=0;v<i.length;v++){if(!a[i.charAt(v)])return!1;a=a[i.charAt(v)]}return!0},f.TokenStore.prototype.getNode=function(i){if(!i)return{};for(var a=this.root,v=0;v<i.length;v++){if(!a[i.charAt(v)])return{};a=a[i.charAt(v)]}return a},f.TokenStore.prototype.get=function(i,a){return this.getNode(i,a).docs||{}},f.TokenStore.prototype.count=function(i,a){return Object.keys(this.get(i,a)).length},f.TokenStore.prototype.remove=function(i,a){if(i){for(var v=this.root,b=0;b<i.length;b++){if(!(i.charAt(b)in v))return;v=v[i.charAt(b)]}delete v.docs[a]}},f.TokenStore.prototype.expand=function(i,a){var v=this.getNode(i);return a=a||[],Object.keys(v.docs||{}).length&&a.push(i),Object.keys(v).forEach(function(b){b!=="docs"&&a.concat(this.expand(i+b,a))},this),a},f.TokenStore.prototype.toJSON=function(){return{root:this.root,length:this.length}},r.exports=f})()}(e),e.exports}();class or{constructor(e,r){this.store=new Map,this.idx=Nt(function(){this.field("name",{boost:10}),((r==null?void 0:r.searchableFields)||[]).forEach(o=>this.field(o)),this.ref("_id"),r!=null&&r.isExactSearch&&(this.pipeline.remove(Nt.stemmer),this.pipeline.remove(Nt.stopWordFilter)),r!=null&&r.removeStopWordFilter&&this.pipeline.remove(Nt.stopWordFilter)});let n=1;(e||[]).map(o=>{o._id=n,++n,this.idx.add(o),this.store.set(o._id,o)})}search_full(e,r){return this.search(e,r).map(n=>this.store.get(n))}search(e,r){return r instanceof Function?(e?this.idx.search(e).map(n=>this.store.get(n.ref)):[...this.store.values()]).filter(r).map(n=>n._id):e?this.idx.search(e).map(n=>n.ref):[...this.store.keys()]}}class ir{constructor(e,r){(r=r||Object.create(null)).aggregations=r.aggregations||Object.create(null),this._items=e,this.config=r.aggregations,this.facets=function(c,p){p=p||[];const u={data:Object.create(null),bits_data:Object.create(null),bits_data_temp:Object.create(null)};let h=1;return p.forEach(l=>{u.data[l]=Object.create(null)}),c&&c.map(l=>(l._id||(l._id=h,++h),l)),c&&c.map(l=>(p.forEach(w=>{if(l){if(Array.isArray(l[w]))l[w].forEach(g=>{l[w]&&(u.data[w][g]||(u.data[w][g]=[]),u.data[w][g].push(parseInt(l._id)))});else if(l[w]!==void 0){const g=l[w];u.data[w][g]||(u.data[w][g]=[]),u.data[w][g].push(parseInt(l._id))}}}),l)),u.data=C(u.data,function(l,w){return u.bits_data[w]||(u.bits_data[w]=Object.create(null),u.bits_data_temp[w]=Object.create(null)),C(l,function(g,y){const d=Go(g);return u.bits_data[w][y]=new B(d),d})}),u}(e,Et(r.aggregations)),this._items_map=Object.create(null),this._ids=[];let n=1;var o,s;s=c=>{this._ids.push(n),this._items_map[n]=c,c._id=n,++n},(W(o=e)?pt:Er)(o,ut(s)),this.ids_map=Object.create(null),e&&e.forEach(c=>{const p=r.custom_id_field||"id";c[p]&&c._id&&(this.ids_map[c[p]]=c._id)}),this._bits_ids=new B(this._ids)}items(){return this._items}bits_ids(e){return e?new B(e):this._bits_ids}internal_ids_from_ids_map(e){return e.map(r=>this.ids_map[r])}index(){return this.facets}get_item(e){return this._items_map[e]}search(e,r){const n=this.config;r=r||Object.create(null);const o=Qt(this.facets);let s;o.not_ids=rr(o.bits_data,e.not_filters);const c=function(p,u){const h=[];return C(p.filters,function(l,w){if(l&&l.length)if(u[w].conjunction!==!1)C(l,function(g){h.push([w,g])});else{const g=[];C(l,function(y){g.push([w,y])}),h.push(g)}}),C(p.not_filters,function(l,w){l&&l.length&&C(l,function(g){h.push([w,"-",g])})}),h}(e,n);return s=function(p,u){const h=Qt(p);let l;u=u||[],C(h.bits_data,function(g,y){C(h.bits_data[y],function(d,m){h.bits_data_temp[y][m]=h.bits_data[y][m]})}),h.is_temp_copied=!0;const w=function(g,y){const d=Object.create(null);return C(y,function(m){if(Array.isArray(m[0])){let j=new B([]);C(m,function(x){const z=x[0];j=j.new_union(g.bits_data[z][x[1]]||new B([])),d[z]=j})}}),d}(p,u);return C(u,function(g){if(!Array.isArray(g[0])){const y=g[0],d=g[1];l=l&&h.bits_data_temp[y][d]?h.bits_data_temp[y][d].new_intersection(l):l&&!h.bits_data_temp[y][d]?new B([]):h.bits_data_temp[y][d]}}),l&&C(h.bits_data_temp,function(g,y){C(h.bits_data_temp[y],function(d,m){h.bits_data_temp[y][m]=h.bits_data_temp[y][m].new_intersection(l)})}),C(u,function(g){if(g.length===3&&g[1]==="-"){const y=h.bits_data_temp[g[0]][g[2]].clone();C(h.bits_data_temp,function(d,m){C(h.bits_data_temp[m],function(j,x){h.bits_data_temp[m][x]=h.bits_data_temp[m][x].new_difference(y)})})}}),C(h.bits_data_temp,function(g,y){C(h.bits_data_temp[y],function(d,m){C(w,function(j,x){x!==y&&(h.bits_data_temp[y][m]=h.bits_data_temp[y][m].new_intersection(j))})})}),h}(this.facets,c),e.filters_query&&(s=function(p,u){const h=Qt(p);h.is_temp_copied||C(h.bits_data,function(w,g){C(h.bits_data[g],function(y,d){h.bits_data_temp[g][d]=h.bits_data[g][d]})});let l=null;return C(u,function(w){let g=null;C(w,function(y){const d=y[0],m=y[1];if(!h.bits_data_temp[d])throw new Error("Panic. The key does not exist in facets lists.");g=g&&h.bits_data_temp[d][m]?h.bits_data_temp[d][m].new_intersection(g):g&&!h.bits_data_temp[d][m]?new B([]):h.bits_data_temp[d][m]}),l=(l||new B([])).new_union(g||new B([]))}),l!==null&&C(h.bits_data_temp,function(w,g){C(h.bits_data_temp[g],function(y,d){h.bits_data_temp[g][d]=h.bits_data_temp[g][d].new_intersection(l)})}),h}(s,Xo(e.filters_query).map(p=>Array.isArray(p)?p.map(u=>Array.isArray(u)?u.map(h=>h):u.split(":")):p.split(":")))),o.bits_data_temp=s.bits_data_temp,C(o.bits_data_temp,function(p,u){C(o.bits_data_temp[u],function(h,l){r.query_ids&&(o.bits_data_temp[u][l]=r.query_ids.new_intersection(o.bits_data_temp[u][l])),r.test&&(o.data[u][l]=o.bits_data_temp[u][l].array())})}),o.ids=e.filters_query?function(p){let u=new B([]);return C(p,function(h,l){C(p[l],function(w,g){u=u.new_union(p[l][g])})}),u}(o.bits_data_temp):rr(o.bits_data_temp,e.filters),o}}function Ko(t,e){let r;(e=e||Object.create(null)).native_search_enabled!==!1&&(r=new or(t,e));let n=new ir(t,e);return{search:function(o){return(o=o||Object.create(null)).aggregations=function(s,c){return C(er(s),(p,u)=>{p.field||(p.field=u);let h=[];c.filters&&c.filters[u]&&(h=c.filters[u]),p.filters=h;let l=[];return c.not_filters&&c.not_filters[u]&&(l=c.not_filters[u]),c.exclude_filters&&c.exclude_filters[u]&&(l=c.exclude_filters[u]),p.not_filters=l,p})}(e.aggregations,o),nr(0,o,e,r,n)},similar:function(o,s){return function(c,p,u){const h=u.per_page||10,l=u.minimum||0,w=u.page||1;let g;for(let m=0;m<c.length;++m)if(c[m].id==p){g=c[m];break}if(!u.field)throw new Error("Please define field in options");const y=u.field;let d=[];for(let m=0;m<c.length;++m)if(c[m].id!==p){const j=Bo(g[y],c[m][y]);j.length>=l&&(d.push(c[m]),d[d.length-1].intersection_length=j.length)}return d=we(d,["intersection_length"],["desc"]),{pagination:{per_page:h,page:w,total:d.length},data:{items:d.slice((w-1)*h,w*h)}}}(t,o,s)},aggregation:function(o){return function(s,c,p,u,h){const l=c.per_page||10,w=c.page||1;if(c.name&&(!p.aggregations||!p.aggregations[c.name]))throw new Error('Please define aggregation "'.concat(c.name,'" in config'));const g=er(c);if(g.page=1,g.per_page=0,!c.name)throw new Error("field name is required");p.aggregations[c.name].size=1e4;const y=nr(0,g,p,u,h).data.aggregations[c.name].buckets;return{pagination:{per_page:l,page:w,total:y.length},data:{buckets:y.slice((w-1)*l,w*l)}}}(0,o,e,r,n)},reindex:function(o){r=new or(t=o,e),n=new ir(t,e)}}}class ti{constructor(){this.loadConfiguration=Ir.bind(this),this.config=null,this.searchEngine=null,this.state={query:"",filters:{},sort:"",bounds:null},this.loaderElement=document.getElementById("loader-container"),this.initialize()}hideLoader(){this.loaderElement&&this.loaderElement.classList.add("loader-hidden")}async initialize(){try{this.config=await this.loadConfiguration();const e=await Nr();this.config.searchConfig.per_page=e.length,this.searchEngine=Ko(e,this.config),console.log("Search engine initialized with data:",e.length,"items"),this.state.sort=this.config.searchConfig.defaultSort;const r={};for(const[o,s]of Object.entries(this.config.aggregations))r[o]=[];this.state.filters=r;const n=Tr(this.config);this.map=n.map,this.markers=n.markers,this.renderMarkers=n.renderMarkers,this.bindEvents(),await this.fetchAggregations(),await this.performSearch(),this.hideLoader()}catch(e){console.error("Initialization error:",e),this.hideLoader()}}bindEvents(){this.setupSearchInput(),this.setupSortSelect(),this.map.on("moveend",()=>this.performSearch())}setupSearchInput(){const e=document.getElementById("search-input");if(!e){console.error("Search input element not found");return}const r=this.debounce(()=>{this.state.query=e.value,this.performSearch()},this.config.searchConfig.debounceTime||300);e.addEventListener("input",r)}setupSortSelect(){const e=document.getElementById("sort-select");if(!e||!this.config.searchConfig.sortOptions){console.error("Sort select element not found or sort options not configured");return}e.innerHTML=this.config.searchConfig.sortOptions.map(r=>`<option value="${r.value}">${r.label}</option>`).join(""),e.addEventListener("change",r=>{this.state.sort=r.target.value,this.performSearch()})}async fetchAggregations(){if(!this.searchEngine){console.error("Search engine not initialized");return}const e=this.searchEngine.search({query:this.state.query||"",filters:this.state.filters}),r={};for(const n in e.data.aggregations)e.data.aggregations.hasOwnProperty(n)&&(r[n]=e.data.aggregations[n].buckets);this.renderFacets(r)}renderFacets(e){if(!e||!this.config.aggregations){console.error("No aggregations data or configuration available.");return}const r=document.getElementById("facets-container"),n={};Object.keys(this.config.aggregations).forEach(o=>{const s=document.getElementById(`${o}-facet`);s&&(n[o]=Array.from(s.querySelectorAll("input:checked")).map(c=>c.value))}),r.innerHTML="",Object.entries(this.config.aggregations).forEach(([o,s])=>{const c=document.createElement("div");c.className="facet-group mb-4",c.id=`${o}-facet`;const p=document.createElement("h3");if(p.className="text-lg font-semibold mb-2",p.textContent=s.title||o,c.appendChild(p),s.type==="range"){const u=document.createElement("div");u.className="facet-slider my-4";const l=(e[o]||[]).map(S=>{const E=parseInt(S.key,10);return isNaN(E)?null:{value:E,count:S.doc_count||0}}).filter(S=>S!==null),w=l.map(S=>S.value),g=Math.min(...w),y=Math.max(...w);u.innerHTML=`
    <label class="sr-only">Value range</label>
    <div class="relative">
      <div id="${o}-chart" class="w-full h-24 mb-2"></div>
    </div>
    <div id="${o}-slider" class="mt-2"></div>
    <div class="mt-5">
      <div class="text-sm font-medium mb-2">Custom range:</div>
      <div class="flex space-x-4">
        <div class="flex-1">
          <input id="${o}-min-input" type="number"
                 class="py-2 px-3 block w-full border rounded-md text-sm focus:ring focus:ring-blue-500 focus:outline-none dark:bg-gray-800 dark:text-gray-300"
                 value="${g}">
        </div>
        <div class="flex-1">
          <input id="${o}-max-input" type="number"
                 class="py-2 px-3 block w-full border rounded-md text-sm focus:ring focus:ring-blue-500 focus:outline-none dark:bg-gray-800 dark:text-gray-300"
                 value="${y}">
        </div>
      </div>
    </div>
  `,c.appendChild(u);const d=u.querySelector(`#${o}-chart`),m=u.querySelector(`#${o}-slider`),j=u.querySelector(`#${o}-min-input`),x=u.querySelector(`#${o}-max-input`);this.renderBarChart(d,l,g,y);const z=this.state.filters[o];let T,k;!z||z.length===0?(T=g,k=y):(T=z[0],k=z[1]),noUiSlider.create(m,{start:[T,k],connect:!0,step:1,range:{min:g,max:y},format:{to:S=>Math.round(S),from:S=>parseInt(S,10)}}),m.noUiSlider.on("update",S=>{j.value=Math.round(Number(S[0])),x.value=Math.round(Number(S[1]))}),m.noUiSlider.on("change",S=>{const[E,P]=S.map(q=>Math.round(Number(q)));!isNaN(E)&&!isNaN(P)&&(this.state.filters[o]=[E,P],this.performSearch(),this.fetchAggregations(),this.updateChartHighlight(d,l,E,P))});const F=this.debounce(S=>{const E=S.target===j,P=parseInt(S.target.value,10),[q,rt]=m.noUiSlider.get().map(Number);isNaN(P)||m.noUiSlider.set([E?P:q,E?rt:P])},200);j.addEventListener("input",F),x.addEventListener("input",F),this.updateChartHighlight(d,l,T,k)}else if(s.type==="taxonomy"){let u=function(d){let m=d.selfCount||0;return Object.values(d.children).forEach(j=>{m+=u(j)}),d.docCount=m,m},h=function(d,m=[],j=0){let x='<ul class="taxonomy-list" style="margin-left: '+j*20+'px;">';return Object.entries(d).forEach(([z,T])=>{var E;if(z==="children"||z==="docCount"||z==="selfCount")return;const k=[...m,z],F=k.join(" > "),S=Object.keys(T.children).length>0;x+=`
              <li class="taxonomy-item">
                <div class="taxonomy-row">
                  ${S?`<span class="toggle-btn" data-path="${F}">▶</span>`:'<span class="toggle-placeholder"></span>'}
                  <label>
                    <input type="checkbox" 
                           value="${F}" 
                           data-facet-type="${o}"
                           ${(E=n[o])!=null&&E.includes(F)?"checked":""}>
                    <span>${z} (${T.docCount})</span>
                  </label>
                </div>
                ${S?`<div class="children" data-parent="${F}" style="display: none;">
                    ${h(T.children,k,j+1)}
                  </div>`:""}
              </li>
            `}),x+"</ul>"};const l=document.createElement("div");l.className="taxonomy-container";const w={};(e[o]||[]).forEach(d=>{const m=d.key.split(" > ");let j=w;m.forEach((x,z)=>{j[x]||(j[x]={children:{},docCount:0,selfCount:0}),z===m.length-1&&(j[x].selfCount=d.doc_count),j=j[x].children})}),Object.values(w).forEach(d=>{u(d)});const y=document.createElement("style");y.textContent=`
          .taxonomy-list {
            list-style: none;
            padding: 0;
          }
          .taxonomy-item {
            margin: 5px 0;
          }
          .taxonomy-row {
            display: flex;
            align-items: center;
            gap: 5px;
          }
          .toggle-btn {
            cursor: pointer;
            width: 20px;
            user-select: none;
          }
          .toggle-placeholder {
            width: 20px;
          }
          .children {
            margin-left: 20px;
          }
        `,document.head.appendChild(y),l.innerHTML=h(w),l.addEventListener("click",d=>{if(d.target.classList.contains("toggle-btn")){const m=d.target.dataset.path,j=l.querySelector(`[data-parent="${m}"]`);if(j){const x=j.style.display==="none";j.style.display=x?"block":"none",d.target.textContent=x?"▼":"▶"}}}),c.appendChild(l)}else{const u=document.createElement("div");u.className="facet-options space-y-2",(e[o]||[]).forEach(l=>{var d;const w=document.createElement("label");w.className="cursor-pointer block",w.style.display="block";const g=document.createElement("input");g.type="checkbox",g.value=l.key,g.className="form-checkbox mr-2",g.dataset.facetType=o,(d=n[o])!=null&&d.includes(l.key)&&(g.checked=!0);const y=document.createElement("span");y.textContent=`${l.key} (${l.doc_count})`,y.className="text-sm",w.appendChild(g),w.appendChild(y),u.appendChild(w)}),c.appendChild(u)}r.appendChild(c)}),this.addFacetEventListeners()}renderBarChart(e,r,n,o){e.innerHTML="";const s=Math.max(...r.map(h=>h.count)),c=document.createElement("div");c.className="flex items-end w-full h-full relative",e.appendChild(c),[...r].sort((h,l)=>h.value-l.value).forEach(h=>{const l=s>0?h.count/s*100:0,w=document.createElement("div");w.className="flex-1 mx-px",w.style.height=`${l}%`,w.style.backgroundColor="#b0c4de",w.dataset.value=h.value,w.dataset.count=h.count,w.title=`Value: ${h.value}, Count: ${h.count}`,c.appendChild(w)});const u=document.createElement("div");u.className="absolute top-0 h-full pointer-events-none",u.style.backgroundColor="rgba(66, 153, 225, 0.3)",u.id=`${e.id}-highlight`,e.appendChild(u)}updateChartHighlight(e,r,n,o){const s=e.querySelector(`#${e.id}-highlight`);if(!s)return;const c=r[r.length-1].value-r[0].value;if(c<=0)return;const p=(n-r[0].value)/c*100,u=(o-n)/c*100;s.style.left=`${p}%`,s.style.width=`${u}%`}onFacetChange(e){const{value:r,checked:n}=e.target,o=e.target.dataset.facetType;n?(this.state.filters[o]||(this.state.filters[o]=[]),this.state.filters[o].push(r)):this.state.filters[o]=this.state.filters[o].filter(s=>s!==r),this.performSearch(),this.fetchAggregations()}handleSliderChange(e,r){const n=e.target.value;this.state.filters[r]=[n],this.performSearch(),this.fetchAggregations()}addFacetEventListeners(){if(!this.config.aggregations){console.error("Aggregations configuration not found");return}Object.keys(this.config.aggregations).forEach(e=>{const r=document.getElementById(`${e}-facet`);r&&r.querySelectorAll("input").forEach(n=>{n.addEventListener("change",this.onFacetChange.bind(this))})})}performSearch(){if(!this.searchEngine){console.error("Search engine not initialized");return}const{filters:e}=this.state,r={},n={},o={};Object.entries(e).forEach(([u,h])=>{if(!h||h.length===0)return;const l=this.config.aggregations[u];if(l)switch(l.type){case"range":n[u]=h;break;case"taxonomy":o[u]=h;break;default:r[u]=h}});const s=this.searchEngine.search({query:this.state.query||"",filters:r,sort:this.state.sort||"title_asc",per_page:526,filter:u=>{for(const[h,l]of Object.entries(n))if(l.length===2){const[w,g]=l,y=new Date(u[h]).getTime();if(!(y>=w&&y<=g))return!1}for(const[h,l]of Object.entries(o)){if(!u[h])return!1;const w=u[h];if(!l.some(y=>w===y||w.startsWith(y+" > ")))return!1}return!0}}),c=s.data.items.filter(u=>u.latitude&&u.longitude).map(u=>[u.latitude,u.longitude]);c.length>0&&L.latLngBounds(c),this.renderMarkers(s.data.items),this.updateResultsList(s.data.items);const p={};for(const u in s.data.aggregations)s.data.aggregations.hasOwnProperty(u)&&(p[u]=s.data.aggregations[u].buckets);this.renderFacets(p)}updateResultsList(e){const r=document.getElementById("results");if(!r){console.error("Results container not found");return}r.innerHTML=e.map(n=>`
        <div class="p-4 bg-white rounded-lg shadow">
          <h3 class="font-semibold">${n.Name}</h3>
          <p>Data: ${n.Year}</p>
        </div>
      `).join("")}debounce(e,r){let n;return function(){clearTimeout(n),n=setTimeout(()=>e.apply(this,arguments),r)}}}document.addEventListener("DOMContentLoaded",()=>{new ti})});export default ei();
